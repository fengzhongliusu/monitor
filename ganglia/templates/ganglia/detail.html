{% extends "ganglia/base.html" %}

{% block title %} 
<div class="row">
    <div class="col-md-6 col-md-offset-3">
        <h2 align=center>
            Resource: {{ resource.res_name }}
            <small>({{resource.res_hostname}})</small>
        </h2>
    </div>
    <div class="col-md-1 col-md-offset-1">
        <small align="right"><a href="{% url 'ganglia:index' %}">Home</a></small>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-xs-2">
            <h4>Metric List</h4>
            <ul class=list-group>
                {% for metric in metric_list %}
                <li class=list-group-item>
                <a onclick="test_click('{{metric.mtc_name}}')">{{metric.mtc_name}}</a>
                </li>
                {% endfor %}
            </ul>
            <h4>Related</h4>
            {% if relate_list %}
            <ul>
                {% for res in relate_list %}
                <li><a href="{% url 'ganglia:detail' res.id %}">{{res.res_name}}</a></li>
                {% endfor %}
            </ul>
            {% else %}
            <h5> no related Resource</h5>
            {% endif %}
        </div>
        <div class="col-md-8">
            <div align="center" class="row">
                {% for metric in metric_list %}
                {% if forloop.counter == 1 %}
                <div id={{ metric.mtc_name }} style="display:block">
                    <div align="center" class="row">graph for {{metric.mtc_name}}</div>
                    <div align="center" class="row">
                        <button onclick="xml_func('{{ metric.mtc_name}}/1/',this)" class="btn btn-primary">last hour</button> 
                        <button onclick="xml_func('{{ metric.mtc_name}}/2/',this)" class="btn btn-primary">last day</button> 
                        <button onclick="xml_func('{{ metric.mtc_name}}/3/',this)" class="btn btn-primary">last week</button> 
                        <button onclick="xml_func('{{ metric.mtc_name}}/4/',this)" class="btn btn-primary">last month</button> 
                    </div>
                    <div id="graph_holder"></div>
                </div>
                {% else %}
                <div id={{ metric.mtc_name }} style="display:none">
                    <div align="center" class="row">graph for {{metric.mtc_name}}</div>
                    <div align="center" class="row">
                        <button onclick="xml_func('{{ metric.mtc_name}}/1/',this)" class="btn btn-primary">last hour</button> 
                        <button onclick="xml_func('{{ metric.mtc_name}}/2/',this)" class="btn btn-primary">last day</button> 
                        <button onclick="xml_func('{{ metric.mtc_name}}/3/',this)" class="btn btn-primary">last week</button> 
                        <button onclick="xml_func('{{ metric.mtc_name}}/4/',this)" class="btn btn-primary">last month</button> 
                    </div>
                    <div id="graph_holder"></div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>



<script type="text/javascript">
function test_click(text){
    {% for metric in metric_list %}      
    if('{{ metric.mtc_name }}' == text)
        document.getElementById('{{ metric.mtc_name }}').style.display='block';
    else
        document.getElementById('{{ metric.mtc_name }}').style.display='none';
    {% endfor %}
}

function xml_func(url,obj){
    var time_ary = new Array();
    var value_ary = new Array();
    var xml_http;
    var base_url = "http://localhost:8000/ganglia/xml/" + '{{ resource.res_hostname}}/' + url;
    var graph_obj = obj.parentNode.parentNode.querySelector("#graph_holder");
    xml_http = new XMLHttpRequest();
    //get child by id 
    xml_http.onreadystatechange = function(){
        if(xml_http.readyState==4 && xml_http.status==200){
            graph_obj.innerHTML = xml_http.responseText;
        }
        else{
            graph_obj.innerHTML = "failed to get msg!!";
        }
    }
    xml_http.open("GET",base_url,true);
    xml_http.send();
}

</script>
{% endblock %}
